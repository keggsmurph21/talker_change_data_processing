---
title: "Talker change data processing"
author: "Letitia Ho"
date: "8/12/2020"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
require("knitr")
library("dplyr")
library("kableExtra")
```

``` {r load_data, echo=FALSE}
setwd('/Applications/eeglab2019/talker-change-data-processing/')
xcorr <- read.csv('data/aggregate/cross_correlation_data.csv')
conv <- read.csv('data/aggregate/convolution_data.csv')
# xcorr_formants <- read.csv('data/aggregate/cross_correlation_formant_data.csv')
# conv_formants <- read.csv('data/aggregate/convolution_formant_data.csv')
```


******

#### 1. Do cortical regions track temporal variation in the speech signal?

```{r, message=FALSE, include = FALSE}
get_one_sample_t <- function(data) {
  channel_columns = paste("X", 1:128, sep = "")
  channels <- select(data, channel_columns)
  p <- apply(channels, MARGIN = 2, function(channel) {t.test(channel)$p.value})
  t <- apply(channels, MARGIN = 2, function(channel) {t.test(channel)$statistic})
  df <- apply(channels, MARGIN = 2, function(channel) {t.test(channel)$parameter})
  return(data.frame("p" = p, "t" = t, "df" = df))
}

# Cross-correlation
xcorr_tracking <- get_one_sample_t(xcorr)
# Number of channels with significant tracking
xcorr_nchans <- sum(xcorr_tracking$p < 0.1)

# Convolution
conv_tracking <- get_one_sample_t(conv)
# Number of channels with significant tracking
conv_nchans <- sum(conv_tracking$p < 0.1)
```

**Table 1. Number of channels significantly tracking the stimuli**

| | count |
| --- | --- |
| cross correlation | `r xcorr_nchans` |
| convolution | `r conv_nchans` |

**Output 1. Channels with significant cross-correlation with stimulus waveform ($\alpha$ < 0.1)** Computed with a one-sample t-test for the cross-correlation of each stimulus waveform with each electrode EEG trace across all conditions.

```{r, echo=FALSE}
xcorr_tracking[which(xcorr_tracking$p < 0.1),]
```

**Output 2. Channels with significant convolution with stimulus waveform ($\alpha$ < 0.1)** Computed with a one-sample t-test for the convolution of each stimulus waveform with each electrode EEG trace across all conditions.

```{r, echo=FALSE}
conv_tracking[which(conv_tracking$p < 0.1),]
```

************

#### 2. Do cortical regions track differently depending on the conditions?

**Table 2. Number of channels significantly tracking the stimuli under each condition** 

```{r, message=FALSE, echo=FALSE}
get_frequency_table <- function(xcorr, conv, title) {
  get_one_frequency_table <- function(data) {
    thresholded = c()
    thresholded[data$p < 0.1] <- 1
    thresholded[data$p > 0.1] <- 0
    counts <- margin.table(table(thresholded), 1)
    proportions <- prop.table(table(thresholded))
    return(data.frame("counts" = c(counts[1], counts[2]), "proportion" = c(proportions[1], proportions[2])))
  }
  
  xcorr_freqs <- get_one_frequency_table(xcorr_talker_s)
  conv_freqs <- get_one_frequency_table(conv_talker_s)

  kable(cbind(xcorr_freqs, conv_freqs), caption = title) %>%
    kable_styling(c("striped", "bordered")) %>%
    add_header_above(c(" ", "Cross-correlation" = 2, "Convolution" = 2))

}

xcorr_talker_s <- filter(xcorr, talker == 'S')
conv_talker_s <- filter(conv, talker == 'S')
# get_frequency_table(get_one_sample_t(xcorr_talker_s), get_one_sample_t(conv_talker_s), title = "talker S")

xcorr_freqs <- get_one_frequency_table(xcorr_talker_s)
conv_freqs <- get_one_frequency_table(conv_talker_s)
# kable(list(kable(xcorr_freqs, caption = 'cross-correlation'),
#            kable(conv_freqs, caption = 'convolution')),
#       caption = title,
#       booktabs = TRUE, valign = 't')

```



**Table 3. Number of channels tracking stimuli significantly differently between levels of the same condition**

```{r}

```


**Output 3. Sample of channels with significant cross-correlation with stimulus waveform under the same-talker condition ($\alpha$ < 0.1)**
```{r, echo=FALSE}
# xcorr_same_talker[which(xcorr_same_talker$p < 0.1),]
```

**Output 4. Sample of channels with significant convolution with stimulus waveform under the same-talker condition ($\alpha$ < 0.1)**
```{r, echo=FALSE}
# conv_same_talker[which(conv_same_talker$p < 0.1),]
```


