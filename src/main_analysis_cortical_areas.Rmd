---
title: "Talker change data processing"
author: "Letitia Ho"
date: "`r format(Sys.time(), '%d %B, %Y, %H:%M')`"
output:
  html_document: default
---

```{r setup, include=FALSE}
require("knitr")
library("dplyr")
library("ggplot2")
library("scatterpie")
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE
) 
```

```{r fns_load_and_subset_data}
get_layout <- function() { 
  fp <- "/Applications/eeglab2019/talker-change-data-processing/data/aggregate/electrode_points"
  coordinates <- read.delim(fp, header = FALSE)
  layout <- data.frame(x = coordinates[[1]], y = -coordinates[[2]]+ 2*mean(coordinates[[2]])) # flip y coords
  return(layout)
}

get_combined_central <- function(aal) {
  for (i in 1:length(aal)) {
    indexes <- grep('central', aal[[i]])
    aal[[i]][indexes] <- 'Central'
  }
  return(aal)
}

get_main_areas <- function(aal, areas) {
  # Init a matrix to store tallies of areas labeled
  tallies = matrix(0, 128, 8) 
  colnames(tallies) <- areas
  
  # Tally
  for (i in 1:length(aal)) {
    for (j in 1:length(aal[[i]])) {
      main_area <- sub("\\_.*", "", aal[[i]][j])
      tallies[i, grep(main_area, areas)] <- tallies[i, grep(main_area, areas)] + 1
    }
  }
  return(as.data.frame(tallies))
}
```

```{r identify main cortical areas}
# Basic graph features
channels <- as.character(1:128)
areas <- c("Temporal", "Frontal", "Occipital", "Supp", "Central", "SupraMarginal", "Angular", "Parietal")

# Load and clean data
load("/Applications/eeglab2019/talker-change-data-processing/data/aggregate/mni_coordinates_areas_aal.Rdata")
aal_cleaned <- get_combined_central(aal)
aal_reduced <- get_main_areas(aal_cleaned, areas)

# Load coordinates and create data frame for plotting
layout <- get_layout()
df <- cbind(channels, layout, aal_reduced)

# Create a custom color scale
myColors <- c("#2c8497", "#2c4f97", "#3f2c97", "#752c97", "#972c84", "#972c4f", "#97452c", "#97702c")
names(myColors) <- levels(df$groups)

ggplot() +
  geom_scatterpie(data = df, cols = areas, aes(x = x, y = y)) +
  coord_equal() +
  geom_text(data = df, aes(x = x, y = y, label = channels), vjust = -1.2, size= 3) +
  scale_color_manual(name = "Region", values = myColors) +
  ylim(0, 900) +
  xlim(0, 900) +
  theme(axis.line=element_blank(),axis.text.x=element_blank(),
        axis.text.y=element_blank(),axis.ticks=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        panel.background=element_blank(),
        panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        plot.background=element_blank())

# add other
# remove midnight

```

